<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>George's Projects</title>
		<link rel="stylesheet" href="screen.css">
		<script type="module">

			import {Wiki} from "./classes/wiki.js";

			function isTrue(value)
			{
				return (
					(value === 'true') ||
					(value === 'True') ||
					(value === '1') ||
					(value === 1)
				);
			}

			function lazyLoad(intersections)
			{
				intersections.forEach(intersection => {
					const image = intersection.target;
					if (intersection.intersectionRatio > 0) {
						if (!isTrue(image.dataset.lazyLoaded)) {
							image.src = image.dataset.lazySrc;
							image.dataset.lazyLoaded = true;
						}
					}
				});
			}

			function overlayImage(imagePath)
			{
				console.log("EXPAND", imagePath);
			}

			async function buildIntroduction()
			{
				document.getElementById('introduction')	
					.replaceWith(await Wiki.getIntroduction());
			}

			async function buildProjects()
			{
				let pages = await Wiki.getPages();
console.log(pages);
				pages = pages.filter(pageName => pageName.includes('Project:'));
console.log(pages);
				document.getElementById('projects')
					.append(...await Promise.all(
						await pages.map(async (projectPath, index) => {
							return await Wiki.getProject(projectPath);
						})
					));
			}

			window.addEventListener('load', async () => {

				const observer = new IntersectionObserver(lazyLoad);

				await buildIntroduction();
				await buildProjects();

				const images = document.querySelectorAll('figure > img.lazy');
				images.forEach(image => {
					observer.observe(image);
					image.addEventListener('click', (event) => {
						overlayImage(event.target.src);
					});
				});
			});

		</script>
	</head>
	<body>
		<main>
			<section id="introduction">
				<h1>George's Projects</h1>
				<p>A collection of projects I've worked on.</p>
			</section>
			<section id="projects"></section>
		</main>
		<svg>
			<clipPath id="edge" clipPathUnits="objectBoundingBox">
				<path d="M1,0.815 C0.991,0.82,0.977,0.806,0.976,0.79 C0.976,0.783,0.974,0.77,0.973,0.76 L0.961,0.757 C0.959,0.767,0.957,0.778,0.955,0.79 C0.947,0.842,0.941,0.853,0.933,0.839 C0.93,0.834,0.926,0.829,0.924,0.828 C0.923,0.828,0.92,0.821,0.918,0.812 C0.914,0.794,0.911,0.791,0.906,0.802 C0.904,0.806,0.9,0.81,0.896,0.811 C0.892,0.811,0.885,0.818,0.882,0.827 C0.872,0.85,0.862,0.85,0.852,0.825 C0.842,0.802,0.837,0.802,0.831,0.825 C0.829,0.834,0.828,0.836,0.825,0.832 C0.823,0.829,0.821,0.831,0.819,0.838 C0.817,0.846,0.814,0.848,0.812,0.844 C0.807,0.838,0.801,0.851,0.799,0.871 C0.796,0.892,0.793,0.9,0.785,0.903 C0.761,0.914,0.763,0.915,0.755,0.893 C0.751,0.881,0.744,0.867,0.739,0.861 C0.734,0.855,0.724,0.843,0.717,0.833 C0.71,0.823,0.703,0.817,0.701,0.818 C0.7,0.82,0.697,0.818,0.696,0.814 C0.694,0.808,0.691,0.808,0.685,0.816 C0.68,0.824,0.675,0.825,0.67,0.821 C0.664,0.816,0.661,0.817,0.66,0.824 C0.657,0.835,0.651,0.826,0.647,0.803 C0.644,0.786,0.631,0.768,0.626,0.773 C0.623,0.776,0.621,0.773,0.619,0.76 C0.617,0.751,0.614,0.743,0.612,0.743 C0.61,0.742,0.607,0.736,0.604,0.728 C0.595,0.706,0.584,0.713,0.574,0.749 C0.569,0.765,0.564,0.784,0.563,0.791 C0.562,0.798,0.56,0.807,0.558,0.809 C0.557,0.812,0.554,0.823,0.552,0.835 C0.547,0.866,0.542,0.878,0.534,0.875 C0.53,0.873,0.524,0.875,0.52,0.88 C0.514,0.886,0.513,0.886,0.509,0.874 C0.505,0.86,0.503,0.863,0.499,0.889 C0.498,0.9,0.496,0.904,0.492,0.903 C0.49,0.903,0.486,0.905,0.484,0.909 C0.478,0.921,0.466,0.916,0.463,0.9 C0.461,0.891,0.459,0.888,0.456,0.89 C0.453,0.892,0.451,0.888,0.449,0.877 C0.446,0.863,0.445,0.862,0.442,0.872 C0.44,0.878,0.436,0.884,0.434,0.886 C0.431,0.889,0.426,0.907,0.42,0.932 L0.411,0.973 L0.404,0.965 C0.399,0.958,0.396,0.959,0.391,0.967 C0.386,0.977,0.384,0.977,0.381,0.968 C0.377,0.96,0.376,0.959,0.373,0.965 C0.372,0.969,0.369,0.97,0.367,0.967 C0.364,0.964,0.362,0.966,0.361,0.973 C0.359,0.982,0.358,0.982,0.355,0.975 C0.352,0.968,0.351,0.969,0.348,0.98 C0.347,0.987,0.343,0.993,0.341,0.993 C0.338,0.993,0.334,0.996,0.331,0.998 C0.328,1,0.326,1,0.324,0.987 C0.322,0.978,0.319,0.968,0.317,0.965 C0.315,0.961,0.313,0.952,0.312,0.937 C0.31,0.92,0.308,0.912,0.303,0.901 C0.299,0.893,0.295,0.88,0.294,0.873 C0.293,0.865,0.289,0.85,0.285,0.839 L0.278,0.819 L0.274,0.836 C0.271,0.845,0.268,0.854,0.266,0.856 C0.263,0.859,0.26,0.873,0.255,0.91 C0.249,0.955,0.247,0.96,0.241,0.97 C0.228,0.989,0.216,0.978,0.212,0.945 C0.21,0.928,0.208,0.92,0.202,0.909 C0.198,0.902,0.193,0.896,0.191,0.895 C0.19,0.895,0.185,0.884,0.18,0.871 C0.176,0.858,0.17,0.845,0.168,0.841 C0.163,0.835,0.149,0.849,0.146,0.863 C0.145,0.868,0.142,0.875,0.139,0.877 C0.136,0.879,0.131,0.886,0.128,0.892 C0.124,0.904,0.123,0.904,0.117,0.883 C0.113,0.871,0.108,0.861,0.106,0.861 C0.104,0.86,0.1,0.851,0.097,0.84 C0.094,0.829,0.089,0.819,0.087,0.819 C0.083,0.818,0.082,0.813,0.08,0.794 L0.077,0.77 L0.066,0.773 C0.048,0.777,0.041,0.77,0.037,0.743 C0.036,0.733,0.033,0.721,0.031,0.715 C0.028,0.706,0.028,0.707,0.024,0.735 C0.018,0.773,0.008,0.812,0.004,0.809 C0.003,0.808,0.001,0.809,0,0.812 L0,0 L1,0 L1,0.815"></path>
			</clipPath>
		</svg>
	</body>
</html>
